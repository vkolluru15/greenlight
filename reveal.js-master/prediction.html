<!DOCTYPE html>
<html>
<head>

	<script src="https://sdk.amazonaws.com/js/aws-sdk-2.265.1.min.js"></script>

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>

	<script type="text/javascript">
		AWS.config.apiVersions = {
		  machinelearning: '2014-12-12',
		  // other service API versions
		};

		AWS.config.update({
		  accessKeyId: 'AKIAIQZ4KWFNPFF2US7A',
		  secretAccessKey: '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',
		  region: 'us-east-1'
		});

		var machinelearning = new AWS.MachineLearning();

		var myData=[
						{
							"ERROR_ID": "error-02e99c90-29af-4f78-9d00-316e449f199e-4N2NP3zjPk5npJguZMe5ZA",
							"LAUNCH_ELAPSED": "6",
							"TOPLEVELEXECUTIONID": "execution-02e99c90-29af-4f78-9d00-316e449f199e-2018.05.08",
							"accountid": "12030",
							"containerid": "39361",
							"dategroup": "2018.05.08",
							"elapsed": "301",
							"error": "Error executing sql statement: Connection reset by peer: socket write error Caused by: Connection reset by peer: socket write error",
							"errordocumentcount": "1",
							"inbound": "1",
							"inboundsize": "0",
							"outbound": "0",
							"outboundsize": "0",
							"starttime": "2018-05-08 11:48:07",
							"status": "ERROR",
							"recorddate": "2018-05-08 11:48:09",
							"atomArch": "64",
							"atomFreeDiskSpace": "80241029120",
							"atomHome": "C:\\Boomi AtomSphere\\Atom - DBregression",
							"atomTimeZone": "America/New_York",
							"fileEncoding": "windows-1252",
							"infrastructureProvider": "AWS",
							"javaHome": "c:\\program files\\java\\jre1.8.0_111",
							"javaVMName": "Java HotSpot(TM) 64-Bit Server VM",
							"javaVersion": "1.8.0_111-b14",
							"localFreeDiskSpace": "1529584493220",
							"maxMemory": "477626368",
							"maxOpenFiles": "",
							"osArch": "amd64",
							"osName": "Windows Server 2008 R2",
							"osVersion": "6.1",
							"systemCpuCount": "4",
							"systemTotalMemory": "8052658176",
							"tempFreeDiskSpace": "80241029120",
							"unlimitedCrypto": "1",
							"Heap Space": "2048",
							"Number of concurrent executions": "42",
							"Purge Days": "30",
							"Classifier": ""
						},
						{
							"ERROR_ID": "error-FakeData",
							"LAUNCH_ELAPSED": "9243",
							"TOPLEVELEXECUTIONID": "FakePloberData-2018-06-26T17:12:26-Rand8317",
							"accountid": "25852",
							"containerid": "62533",
							"dategroup": "2018.06.01",
							"elapsed": "5971",
							"error": "Java heap space",
							"errordocumentcount": "1",
							"inbound": "1",
							"inboundsize": "0",
							"outbound": "2",
							"outboundsize": "1453",
							"starttime": "2018-06-01 17:41:21",
							"status": "ERROR",
							"recorddate": "2018-06-01 17:42:54",
							"atomArch": "64",
							"atomFreeDiskSpace": "257399267328",
							"atomHome": "\\\\winfs1\\DATA\\Boomi AtomSphere\\Cloud - Thanos",
							"atomTimeZone": "America/New_York",
							"fileEncoding": "windows-1252",
							"infrastructureProvider": "AWS",
							"javaHome": "c:\\java\\jdk1.8.0_66\\jre",
							"javaVMName": "Java HotSpot(TM) 64-Bit Server VM",
							"javaVersion": "1.8.0_66-b17",
							"localFreeDiskSpace": "1530090143408",
							"maxMemory": "477626368",
							"maxOpenFiles": "",
							"osArch": "amd64",
							"osName": "Windows Server 2008 R2",
							"osVersion": "6.1",
							"systemCpuCount": "2",
							"systemTotalMemory": "4294561792",
							"tempFreeDiskSpace": "33847291904",
							"unlimitedCrypto": "TRUE",
							"Heap Space": "2048",
							"Number of concurrent executions": "10",
							"Purge Days": "30",
							"Classifier": ""
						},
						{
							"ERROR_ID": "error-FakeData",
							"LAUNCH_ELAPSED": "4208",
							"TOPLEVELEXECUTIONID": "FakePloberData-2018-06-26T17:12:26-Rand3857",
							"accountid": "19941",
							"containerid": "76091",
							"dategroup": "2018.05.30",
							"elapsed": "89",
							"error": "Java heap space",
							"errordocumentcount": "1",
							"inbound": "1",
							"inboundsize": "0",
							"outbound": "0",
							"outboundsize": "0",
							"starttime": "2018-05-30 14:54:31",
							"status": "ERROR",
							"recorddate": "2018-05-30 14:54:32",
							"atomArch": "64",
							"atomFreeDiskSpace": "257399267328",
							"atomHome": "\\\\winfs1\\DATA\\Boomi AtomSphere\\Cloud - Thanos",
							"atomTimeZone": "America/New_York",
							"fileEncoding": "windows-1252",
							"infrastructureProvider": "AWS",
							"javaHome": "c:\\java\\jdk1.8.0_66\\jre",
							"javaVMName": "Java HotSpot(TM) 64-Bit Server VM",
							"javaVersion": "1.8.0_66-b17",
							"localFreeDiskSpace": "1530090143408",
							"maxMemory": "477626368",
							"maxOpenFiles": "",
							"osArch": "amd64",
							"osName": "Windows Server 2008 R2",
							"osVersion": "6.1",
							"systemCpuCount": "2",
							"systemTotalMemory": "4294561792",
							"tempFreeDiskSpace": "33847291904",
							"unlimitedCrypto": "TRUE",
							"Heap Space": "1024",
							"Number of concurrent executions": "3",
							"Purge Days": "30",
							"Classifier": ""
						},
						{
							"ERROR_ID": "NULL",
							"LAUNCH_ELAPSED": "3841",
							"TOPLEVELEXECUTIONID": "execution-1a4878c2-66e5-4113-9b24-fdc21f72aaf5-2018.06.13",
							"accountid": "18255",
							"containerid": "13547",
							"dategroup": "2018.06.13",
							"elapsed": "4282",
							"error": "NULL",
							"errordocumentcount": "0",
							"inbound": "1",
							"inboundsize": "0",
							"outbound": "0",
							"outboundsize": "0",
							"starttime": "2018-06-13 16:32:00",
							"status": "COMPLETE",
							"recorddate": "2018-06-13 16:32:08",
							"atomArch": "64",
							"atomFreeDiskSpace": "405456355328",
							"atomHome": "/mnt/data/cloud/Biggie",
							"atomTimeZone": "US/Eastern",
							"fileEncoding": "UTF-8",
							"infrastructureProvider": "AWS",
							"javaHome": "/usr/java/jdk1.8.0_66/jre",
							"javaVMName": "Java HotSpot(TM) 64-Bit Server VM",
							"javaVersion": "1.8.0_66-b17",
							"localFreeDiskSpace": "1529585393691",
							"maxMemory": "1908932608",
							"maxOpenFiles": "8192",
							"osArch": "amd64",
							"osName": "Linux",
							"osVersion": "2.6.32-696.23.1.el6.x86_64",
							"systemCpuCount": "4",
							"systemTotalMemory": "7855697920",
							"tempFreeDiskSpace": "58102837248",
							"unlimitedCrypto": "TRUE",
							"Heap Space": "1024",
							"Number of concurrent executions": "29",
							"Purge Days": "14",
							"Classifier": ""
						}
					];

		$(document).ready(function(){
			var highPred="";
			$("#predict").click(function(){
				// var predictionTables = $(".prediction");
				for (var i = 0; i < 4; i++) {
					var table = $("table").html();
					var predictedScoresAWS=[];
					var params = {
					  MLModelId: 'ml-hYx5KJe9hJy', /* required */
					  PredictEndpoint: 'https://realtime.machinelearning.us-east-1.amazonaws.com', /* required */
					  Record: myData[i]
					};
						machinelearning.predict(params, function(err, data) {
						  if (err){
						  	console.log(err, err.stack); // an error occurred
						  } else{
					  	console.log(data);           // successful response
					  	// data = $.parseJSON(data);
					  	predictedScoresAWS.push(data.Prediction.predictedScores['Reduce purge history day count']);
					  	predictedScoresAWS.push(data.Prediction.predictedScores['Increase the java heap space']);
					  	predictedScoresAWS.push(data.Prediction.predictedScores['Successful run']);
					  	predictedScoresAWS.push(data.Prediction.predictedScores['Other error']);
					  	console.log(predictedScoresAWS)
					  	var highPredIndex = predictedScoresAWS.indexOf(Math.max(...predictedScoresAWS))
					  	switch(highPredIndex){
					  		case 0:
					  			highPred='Reduce purge history day count';
					  			break;
					  		case 1:
					  			highPred='Increase the java heap space';
					  			break;
					  		case 2:
					  			highPred='Successful run';
					  			break;
					  		case 3:
					  			highPred='Other error';
					  	}
					  	table = table.replace(' class="prediction">','><strong>'+highPred+"<strong>");
					  	while (predictedScoresAWS.length) { predictedScoresAWS.pop(); }
						$("table").html(table);
						}
					});
				}
			});

		});
	</script>
</head>
<body style="background-color: rgba(210, 235, 240, 0)">
	<div style="text-align: center;" class="well" id="result">
		<table class="table table-striped table-dark">
			<thead>
				<tr>
					<th scope="col">Error</th>
					<th scope="col">Elapsed time</th>
					<th scope="col">Inbound</th>
					<th scope="col">Inbound size</th>
					<th scope="col">Outbound</th>
					<th scope="col">Outbound size</th>
					<th scope="col">Heap Size</th>
					<th scope="col"># of concurrent executions</th>
					<th scope="col">Purge History Value</th>
					<th scope="col">Actual Message</th>
					<th scope="col">Predicted Value</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<th scope="row">Error invoking soap operation Caused by: The server sent HTTP status code 503: Atom is shutting down</th>
					<td>165605</td>
					<td>1</td>
					<td>92</td>
					<td>1</td>
					<td>318</td>
					<td>2048</td>
					<td>45</td>
					<td>14</td>
					<td>Other error</td>
					<td class="prediction"></td>
				</tr>
				<tr>
					<th scope="row">Java heap space</th>
					<td>3</td>
					<td>1</td>
					<td>0</td>
					<td>12</td>
					<td>11286</td>
					<td>2048</td>
					<td>31</td>
					<td>30</td>
					<td>Reduce purge history day count</td>
					<td class="prediction"></td>
				</tr>
				<tr>
					<th scope="row">Java heap space</th>
					<td>264</td>
					<td>1</td>
					<td>0</td>
					<td>0</td>
					<td>0</td>
					<td>1024</td>
					<td>50</td>
					<td>30</td>
					<td>Increase the java heap space</td>
					<td class="prediction"></td>
				</tr>
				<tr>
					<th scope="row">NULL</th>
					<td>2480</td>
					<td>1</td>
					<td>191</td>
					<td>2</td>
					<td>10326</td>
					<td>1024</td>
					<td>32</td>
					<td>30</td>
					<td>Successful run</td>
					<td class="prediction"></td>
				</tr>
			</tbody>
		</table>
	</div>
	<div style="text-align: center;">
		<form class="form-inline">
			<button type="button" class="btn btn-primary" id="predict">Predict</button>
		</form>
	</div>
</body>
</html>
